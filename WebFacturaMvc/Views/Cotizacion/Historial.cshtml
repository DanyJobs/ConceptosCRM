@model List<Model.Entity.Cotizacion>
@{
    ViewBag.Title = "Index";
}
@*<script src="~/Scripts/jquery-1.10.2.min.js"></script>*@
<script src="~/Js/alertify.min.js"></script>
<link href="~/Css/alertify.core.css" rel="stylesheet" />
<link href="~/Css/alertify.default.css" rel="stylesheet" />
@*<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>*@
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script language="javascript">
    window.onload = function () {

        $("td").each(function () {

            if ($(this).text() == 'Alto') {

                this.style.backgroundColor = 'red'
                this.style.color = 'White';
            }
            if ($(this).text() == 'Medio') {
                this.style.backgroundColor = 'orange'
                this.style.color = 'White';
            }
            if ($(this).text() == 'Bajo') {
                this.style.backgroundColor = 'green'
                this.style.color = 'White';
            }
        });
    }

    $('document').ready(function () {
        $("#checkTodos").change(function () {
            $("input:checkbox").prop('checked', $(this).prop("checked"));
        });
    });


 
    function finalizar() {
            var i = 0;
            var envio = "{";
/*         $("#table tbody tr").find("checkbox").each(function () {*/
             $("input[type=checkbox]:checked").each(function () {
                 //cada elemento seleccionado 
                 if ($(this).parent().parent().find('td').eq(1).text() != "") {
                   
                     if (i == 0) {
                         envio += "ListadoDetalle:['" + $(this).parent().parent().find('td').eq(1).text() + "'";
                     } else {
                         envio += ",'" + $(this).parent().parent().find('td').eq(1).text() + "'"
                     }
                     i = 1;
                 } 
             });
        envio += "]}";
        if (envio == "{]}") {
            alert("Debes seleccionar minimo un registro");
        } else {           
            var json = eval("(" + envio + ')');
            //alertify.alert("INGRESE DATOS");
            console.info(json);
            $.ajax({
                url: "EnviarCorreos",
                data: JSON.stringify(json),
                type: "POST",
                async: false,//this makes the ajax-call blocking
                contentType: 'application/json;charset=UTF-8',
                dataType: 'json',
                success: function (response) {
                    alertify.alert(response);
                    valid = response.valid;
                }
                //   },
                //   error: function (error) {
                //       console.log(error);
                //       console.log("UN ERROOOOOOR");
                ///*       alertify.alert(error);*/
                //   }
            });
        }       
    }
 
 

</script>
<h2 id="titulo" style="text-align:center; font-family:Arial; font-weight:700;">Cotizaciones realizadas</h2>

@using (Html.BeginForm())
{
<br>
<p id="mensaje"></p>

<h4 style="text-align:center; font-family:Arial; ">Filtrar por fecha:</h4>
<fieldset>
    <div class="form-group col-md-3">
        @Html.Label("Mes", new { @class = "control-label col-md-4" })
        <div class="col-md-8">
            @Html.DropDownList("txtMes", (IEnumerable<SelectListItem>)ViewBag.ListaMeses,
         "Seleccionar", htmlAttributes: new { @class = "form-control" })
        </div>
    </div>
    <div class="form-group col-md-3">
        @Html.Label("Año", new { @class = "control-label col-md-4" })
        <div class="col-md-8">
            @Html.DropDownList("txtYear", (IEnumerable<SelectListItem>)ViewBag.ListaYears,
         "Seleccionar", htmlAttributes: new { @class = "form-control" })
        </div>
    </div>
    <div class="form-group col-md-3">
        @Html.Label("Estatus", new { @class = "control-label col-md-4" })
        <div class="col-md-8">
            @Html.DropDownList("txtEstatus", (IEnumerable<SelectListItem>)ViewBag.Estatus, "Seleccionar", new { @class = "form-control" })
        </div>
    </div>
</fieldset>
<input class="btn btn-primary" type="submit" value="Buscar" />
}
<input class="btn btn-success btn-lg" type="button" id="finalizar" onclick="finalizar()" value="Enviar Correos" />
<table class="table" id="table">
    <thead>
        <tr class="bg-primary">

            <th><input type="checkbox" id="checkTodos" value="checkTodos"></th>
            <th>Id Venta</th>
            <th>Total</th>
            <th>Cliente</th>
            <th>Fecha</th>
            <th>IVA(%)</th>
            <th>Estatus</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var objCotizacion in Model)
        {
            <tr align="center" id="tabla">
                <td> @Html.CheckBox("Accion", new { @class = "control-label col-md-7", @value = @objCotizacion.IdVenta }) </td>
                <td>@objCotizacion.IdVenta</td>
                <td>@objCotizacion.Total</td>
                <td>@objCotizacion.Cliente</td>
                <td>@objCotizacion.FechaCotizacion.ToString("MM/dd/yyyy")</td>
                <td>@objCotizacion.Iva</td>
                <td>@objCotizacion.estatus</td>
                <td><a class="btn btn-info" href="~/DetalleCotizacion/DetalleCotizacion?idVenta=@objCotizacion.IdVenta"><span class="glyphicon glyphicon-eye-open">|Verdetalles</span></a></td>
                <td><a class="btn btn-warning" href="~/DetalleCotizacion/Editar"><span class="glyphicon glyphicon-pencil">|Editar</span></a></td>
                <td><a class="btn btn-danger" href="~/DetalleCotizacion/Eliminar?idVenta=@objCotizacion.IdVenta"><span class="glyphicon glyphicon-remove">|Eliminar</span></a></td>
            </tr>
        }
    </tbody>
</table>
